<!DOCTYPE HTML>
<html lang="zh-TW" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Day 26 - Web3 與資安：攻擊方式與資產保護（上） - Web3 Fullstack 開發 30 天</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Web3 Fullstack 開發 30 天</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="day-26day-26---web3-與資安攻擊方式與資產保護上"><a class="header" href="#day-26day-26---web3-與資安攻擊方式與資產保護上">DAY 26｜Day 26 - Web3 與資安：攻擊方式與資產保護（上）</a></h1>
<ul>
<li>原文：https://ithelp.ithome.com.tw/articles/10334895</li>
<li>發佈時間：2023-10-05 21:31:07</li>
</ul>
<h2 id="章節內容"><a class="header" href="#章節內容">章節內容</a></h2>
<h3 id="1-未分章內容"><a class="header" href="#1-未分章內容">1. 未分章內容</a></h3>
<p>今天跟明天的內容會來介紹 Web3 世界裡有哪些需要注意的資安風險，以及作為使用者我們可以怎麼預防資產被盜走。經過前面 25 天的內容我們已經對 Web3 技術有許多了解，可以幫助我們深入理解每種攻擊跟防禦的原理。</p>
<h3 id="2-暗黑森林"><a class="header" href="#2-暗黑森林">2. 暗黑森林</a></h3>
<p>有些人把區塊鏈比喻成黑暗森林，原因是有大量的攻擊手法持續出現，只要稍有不慎自己的資產就有可能陷入危險，而過去也有許多業界知名人士遭駭的案例，就算是資深玩家也難以倖免。</p>
<p>慢霧是間在 Web3 算知名的資安審計公司，他們有一份<a href="https://github.com/slowmist/Blockchain-dark-forest-selfguard-handbook">區塊鏈黑暗森林自救手冊</a>（中文版在<a href="https://github.com/slowmist/Blockchain-dark-forest-selfguard-handbook/blob/main/README_CN.md">這裡</a>），裡面詳細介紹了許多攻擊的手法與如何防禦，他們用以下這張圖來總結所有的面向：</p>
<p><img src="images/day26-img001-869e9e2edf.png" alt="images/day26-img001-869e9e2edf.png" /></p>
<p>橘色的部分是我加上的，粗略把這張圖分成三塊：操作、錢包和裝置。操作指的是當使用者用錢包進行任何 DApp 操作時，可能被攻擊的點。裝置指的是若使用者的裝置本身被入侵的風險。錢包則是關於錢包 App 的資安風險、私鑰與註記詞的保存等問題。今天會先介紹操作的問題以及平常使用 DApp 時應該要注意哪些東西。</p>
<h3 id="3-詐騙案例"><a class="header" href="#3-詐騙案例">3. 詐騙案例</a></h3>
<p>舉個常見的案例，在 Twitter 或 Discord 等社群平台上有許多幣圈的社群跟廣告，常常會有詐騙的人在上面宣傳甚至直接密你，把他的東西包裝成可以領取某個獎勵或是 NFT 引導我們點進去。這時可能會看到像這樣的網頁：</p>
<p><img src="images/day26-img002-8c293c03de.png" alt="images/day26-img002-8c293c03de.png" /></p>
<p>看起來很正常，但輸入完資訊按下一步送出後跳出了這個簽名的請求：</p>
<p><img src="images/day26-img003-2ef70b68a6.png" alt="images/day26-img003-2ef70b68a6.png" /></p>
<p>如果對一般看不懂簽名請求的使用者來說，可能來不及看懂這裡面在做什麼就按下簽名了，而這時最嚴重的情況會導致他的 NFT 全部都被轉走！原理今天會提到，但這正是區塊鏈操作的可怕之處：所有釣魚網站都會做得很精緻，目的就是要誘導使用者按下簽名，而在 Web3 世界任何操作都代表價值的流動或資產轉移，對駭客來說只需要花相對低的成本就可以取得很高的報酬，而且金流還能透過 Tornado Cash 之類的服務做到無法被追蹤。</p>
<p>特別是近幾個月出現越來越多知名 KOL 或知名 Web3 項目的 Twitter 被駭（最常見是透過 SIM Swap 攻擊），導致官方帳號貼出了釣魚網站的資訊，許多人就會信以為真進去操作，往往造成大量的資產損失。</p>
<p>因此接下來會列舉幾個常見的範例來讓讀者理解怎樣的操作可能會有風險，因為在錢包 App 中的確認訊息是不可能被偽造的（除非連 Metamask 都被發現漏洞），錢包 App 跳出來的彈窗內才是最正確的內容，不管網頁上寫他是要送你一些幣還是免費 mint 一些 NFT 都不能相信。</p>
<h3 id="4-approve-操作"><a class="header" href="#4-approve-操作">4. Approve 操作</a></h3>
<p>首先一個常見的風險是直接呼叫 ERC-20 的 <code>approve</code> 方法或是 ERC-721, ERC-1155 的 <code>setApprovalForAll</code>方法，把自己的 Token 或 NFT 授權給別人，這個在 Metamask 的確認頁面中就看得出來：</p>
<p><img src="images/day26-img004-776c6cd944.png" alt="images/day26-img004-776c6cd944.png" /></p>
<p>因此如果在確認頁面中看到 Approve 或 Approval 相關的字眼就要特別小心，。但這類型操作有時比較難分辨的原因是像在 Uniswap, Opensea 等知名平台上也會有需要使用者 Approve 資產的操作，也會使用到 <code>approve</code> 或是 <code>setApprovalForAll</code> 方法。因此要準確的區分就必須檢查當下互動的合約地址是否真的是該協議的地址，例如把地址貼到 Etherscan 上查詢。</p>
<p>另外一個可以再次確認的是 Approve 的對象，也就是授權哪個地址使用自己的資產。現在 Metamask 中會顯示 Approve 交易的細節，點擊 Verify third-party details 可以看到當下正要 Approve 的 spender 是誰：</p>
<p><img src="images/day26-img005-d734285edb.png" alt="images/day26-img005-d734285edb.png" /></p>
<p>在惡意的網站通常他會要求你 approve 一個 EOA 地址可以使用你的資產，而這就是最大的風險：駭客可以持續監聽鏈上的狀態，只要發現有人 Approve 了他的 EOA 地址使用一些資產，就馬上用那個 EOA 發交易把受害者的資產全部轉走。因此點擊 Open in block explorer 查看是授權給哪個地址也是很重要的。</p>
<h3 id="5-簽名零元購訊息"><a class="header" href="#5-簽名零元購訊息">5. 簽名「零元購」訊息</a></h3>
<p>這是在 NFT 交易盛行時常見的一種詐騙手法，也是誘導使用者簽名，而這次簽名的東西是「允許零元購」的 Typed Data，呈現的範例就是一開始詐騙案例圖中的樣子，該範例是要求簽名一個 Seaport 的訊息。</p>
<p><img src="images/day26-img006-104cdea758.png" alt="images/day26-img006-104cdea758.png" /></p>
<p>那麼 Seaport 到底是什麼以及他的風險為何？它其實是 Opensea 提出的 NFT marketplace 的合約標準，Opensea 的官方文件有詳細的解釋：https://docs.opensea.io/reference/seaport-overview</p>
<p>但這個協議很複雜很難短時間內完全理解，因為他支援買賣雙方可以用任意數量的 ERC-20, ERC-721, ERC-1155 Token 來交易，例如我拿 1 ETH + 一個 Azuki NFT 跟你換兩個 Beanz NFT 加一個 Otherside 土地的這種交易，非常有彈性。</p>
<p>不過對用戶來說主要的操作就是：在掛賣 NFT 前先 Approve Opensea 的合約使用自己的 NFT，並且簽名一個 Seaport 的 Typed Data 來代表「我願意用 xxx 價格賣出這個 NFT」的訊息，這樣未來的買家若看到滿意的 NFT 想購買，就只要把賣家已經簽好的 Signature 搭配自己發出的 ETH 送到 Opensea 的 Seaport 合約中，若通過 Seaport 合約的驗證它就會自動把對應的 NFT 轉給買家、ETH 轉給賣家（並抽一些手續費）。這樣的好處是對賣家來說不需要預先把手上的 NFT 轉給 Opensea 就能掛賣並由其他人成交。</p>
<p>因此這就是駭客可以利用的點：搭配 Seaport 協議的彈性，釣魚網站可以先偵測該受害者所有的 NFT collection，判斷哪些 collection 是他已經有 Approve 過 Seaport 合約使用的，找出來後騙受害者簽名一個類似「我願意用 0.0001 ETH 賣出 3 個 Azuki、5 個 BAYC、2 個 MAYC」這樣的訊息，若受害者上當他就可以馬上拿這個簽章到 Seaport 的合約去成交這筆交易，也就等同於把受害者的所有有價值的 NFT 全部轉走了。</p>
<p>幾個月前就有位受害者因為這個釣魚事件，被轉走了十幾個 BAYC 損失超過千萬，非常可怕。</p>
<p><img src="images/day26-img007-b78923c221.png" alt="images/day26-img007-b78923c221.png" /></p>
<p>了解這個攻擊手法後，防禦的方式就很簡單：只要在 Opensea 以外的網站看到 Seaport 相關的訊息就不要簽名，因為很有可能是釣魚。</p>
<p>當然也不止 Opensea 合約有這樣的風險，任何 NFT marketplace 都可能有一樣的攻擊方式，例如 Blur 這個 NFT marketplace 的 bulk listing 簽名資料長得像以下這樣（<a href="https://x.com/realScamSniffer/status/1632707177445212160?s=20">參考連結</a>）：</p>
<p><img src="images/day26-img008-7c083356f7.png" alt="images/day26-img008-7c083356f7.png" /></p>
<p>簽下去就有風險讓自己所有在 Blur 上 Approve 過的 NFT 全部被轉走。這個因為簽名中不會顯示 Blur 所以更容易被騙。因此最謹慎的方式是看到任何 Typed Data 如果是看不懂的話就不要簽，因為有可能被拿來送到某個你不知道的合約觸發了某些效果。</p>
<h3 id="6-permit-訊息簽名"><a class="header" href="#6-permit-訊息簽名">6. Permit 訊息簽名</a></h3>
<p>在 Day 25 中有介紹到部分 ERC-20 Token 會有 Permit 的功能，方便使用者不需要發送獨立的 Approve 交易就可以透過簽名 Typed Data 的方式來授權自己的 ERC-20 Token。而這就類似上面 NFT marketplace 的攻擊方式：只要騙使用者簽名一個 Permit 訊息，駭客就能把這個簽章送到對應的 ERC-20 合約中允許自己把使用者的所有幣轉走。因此當簽名訊息中有 Permit 相關文字時也要特別小心。</p>
<h3 id="7-eth_sign-盲簽"><a class="header" href="#7-eth_sign-盲簽">7. eth_sign 盲簽</a></h3>
<p>這個簽名方式非常危險，它是當我們在簽名所有交易或是訊息時最底層的一個方法。原理是不管交易或是訊息最終都會被 hash 成一個 64 bytes 的資料，並呼叫 eth_sign 方法來產生最終的簽名。因此如果駭客直接請求 eth_sign 的簽名，他就可以要求簽任何的交易或訊息而讓使用者完全看不出來！簽名請求如下：</p>
<p><img src="images/day26-img009-b62220133e.png" alt="images/day26-img009-b62220133e.png" /></p>
<p>（<a href="https://twitter.com/SlowMist_Team/status/1581955691350106112?s=20">參考連結</a>）</p>
<p>雖然有很長的警告訊息，但應該是還是有人忽略警告訊息按下簽名，導致資產被駭。因此最近 eth_sign 這個功能已經被 Metamask 預設關閉了（<a href="https://support.metamask.io/hc/en-us/articles/14764161421467-What-is-eth-sign-and-why-is-it-a-risk-">官方說明</a>），也非常不建議使用者打開，因此如果不改設定的話就不會再遇到這個簽名請求了。</p>
<h3 id="8-補充說明"><a class="header" href="#8-補充說明">8. 補充說明</a></h3>
<p>前面講到關於簽名交易跟 Typed Data 都會有風險，那麼簽名 Personal Message 呢？一般來說因為 Personal Message 不會被放到鏈上的智能合約中做驗證（原因在 Day 7 有提到），因此其實不會有什麼問題。</p>
<h3 id="9-防禦方法"><a class="header" href="#9-防禦方法">9. 防禦方法</a></h3>
<p>了解以上許多攻擊方式後，就可以總結幾個防禦的方法，主要是在進行任何簽名時要注意：</p>
<ul>
<li>確認清楚合約地址、要執行的操作、要 Approve 的對象等等
<ul>
<li>確認簽名訊息的內容與作用合約</li>
<li>不要忽略警告訊息</li>
</ul>
</li>
</ul>
<p>還有一個比較少人注意但有效的防禦方式，就是可以把已知的合約地址加入 Metamask 的 Contacts 中，這樣在簽名交易時就會顯示右邊自己設定的別名「Uniswap」而非左邊看不懂的 hex 字串：</p>
<p><img src="images/day26-img010-3a55c107eb.png" alt="images/day26-img010-3a55c107eb.png" /></p>
<p>設定方式很簡單，只要在跟合約互動時點擊合約地址，幫他加一個 Nickname 後儲存就可以了。另外也可以在 Metamask 的設定頁面中找到 Contacts 新增常用的地址簿。相關步驟如下圖：</p>
<p><img src="images/day26-img011-3f2d9e123f.png" alt="images/day26-img011-3f2d9e123f.png" /></p>
<p>這樣就能省去每次還要到鏈上查這個地址的時間了！</p>
<h3 id="10-小結"><a class="header" href="#10-小結">10. 小結</a></h3>
<p>今天我們介紹了許多區塊鏈上可能會遇到的詐騙/釣魚手法、背後的原理以及如何防禦。區塊鏈上的攻擊方式不斷推陳出新，因此未來還是很可能出現其他攻擊手法，因此最重要還是確保自己能理解所有正在進行的操作，才能把風險降到最低。明天會延續操作問題再介紹幾個案例，並把剩餘的錢包與裝置問題與防禦方式講解完。</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="day25-day-25-web3-與進階-app-swap-功能實作.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="day27-day-27-web3-與資安-攻擊方式與資產保護-下.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="day25-day-25-web3-與進階-app-swap-功能實作.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="day27-day-27-web3-與資安-攻擊方式與資產保護-下.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>
