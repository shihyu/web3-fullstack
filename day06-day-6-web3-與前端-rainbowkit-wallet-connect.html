<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>DAY 6｜Day 6 - Web3 與前端：RainbowKit + Wallet Connect - Web3 全端工程師的技術養成之路</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Web3 全端工程師的技術養成之路</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="day-6day-6---web3-與前端rainbowkit--wallet-connect"><a class="header" href="#day-6day-6---web3-與前端rainbowkit--wallet-connect">DAY 6｜Day 6 - Web3 與前端：RainbowKit + Wallet Connect</a></h1>
<ul>
<li>原文：https://ithelp.ithome.com.tw/articles/10318382</li>
<li>發佈時間：2023-09-15 02:21:38</li>
</ul>
<h2 id="章節內容"><a class="header" href="#章節內容">章節內容</a></h2>
<h3 id="1-未分章內容"><a class="header" href="#1-未分章內容">1. 未分章內容</a></h3>
<p>前兩天我們把 DApp 的一些基礎功能開發出來了，但還沒有在 UI/UX 上著墨太多。今天要介紹的 Rainbow Kit 就是可以用來快速開發一個好看的連接錢包功能的 library，包含多種錢包連接選項、更改主題顏色等等，從這裡也會延伸介紹他支援的 Wallet Connect 協議，並實際串上 Wallet Connect 協議來發送交易。</p>
<h3 id="2-rainbow-kit"><a class="header" href="#2-rainbow-kit">2. Rainbow Kit</a></h3>
<p><a href="https://www.rainbowkit.com/">Rainbow Kit</a> 是由 Rainbow 錢包開發的 Web SDK，許多 DApp 都有使用，主要是因為他的 UI/UX 做得很好，整合上也很容易。要看呈現效果的話可以在他的官網右上角點擊 Connect Wallet 看到連接錢包的列表</p>
<p><img src="images/day06-img001-4cda0a6205.png" alt="https://ithelp.ithome.com.tw/upload/images/20230915/201622947tjlIsgQLe.png" /></p>
<p>點擊 Metamask 並在 Metamask 的彈窗中確認後就成功連接上了，右上角的 Connect Wallet 按鈕會變成顯示選擇的鏈、地址跟 ETH 餘額</p>
<p><img src="images/day06-img002-ed40545a89.png" alt="https://ithelp.ithome.com.tw/upload/images/20230915/201622941GPIgJZNQK.png" /></p>
<p>這裡面有許多可以更改的選項，接下來就直接按照官方的<a href="https://www.rainbowkit.com/docs/installation">安裝步驟</a>用 rainbowkit 建立一個新的 <a href="https://wagmi.sh/">wagmi</a> + <a href="https://nextjs.org/">Next.js</a> app：</p>
<p>[code]
pnpm create @rainbow-me/rainbowkit@latest</p>
<p>[/code]</p>
<p>照著 cli 指示就能建立好一個新的專案了。進到剛創立的資料夾執行 <code>pnpm dev</code> 就可以把它跑起來：</p>
<p><img src="images/day06-img003-58fac6ae12.png" alt="https://ithelp.ithome.com.tw/upload/images/20230915/20162294BmsZpPecWM.png" /></p>
<p>在 <code>_app.tsx</code> 裡可以看到詳細的用法，前面的 <code>configureChains</code> 之前有介紹過，再來用 <code>getDefaultWallets</code> 拿到預設的錢包列表（包含 Rainbow, Coinbase Wallet, Metamask 等等），用它建立 wagmi config，並把整個 App 包在 <code>RainbowKitProvider</code> 底下，就可以在任何地方使用 Rainbow Kit 提供的 Components。</p>
<p>[code]
const { chains, publicClient, webSocketPublicClient } = configureChains(
[
mainnet,
polygon,
optimism,
arbitrum,
base,
zora,
...(process.env.NEXT_PUBLIC_ENABLE_TESTNETS === 'true' ? [goerli] : []),
],
[publicProvider()]
);</p>
<pre><code>const { connectors } = getDefaultWallets({
  appName: 'RainbowKit App',
  projectId: 'YOUR_PROJECT_ID',
  chains,
});

const wagmiConfig = createConfig({
  autoConnect: true,
  connectors,
  publicClient,
  webSocketPublicClient,
});

function MyApp({ Component, pageProps }: AppProps) {
  return (
    &lt;WagmiConfig config={wagmiConfig}&gt;
      &lt;RainbowKitProvider chains={chains}&gt;
        &lt;Component {...pageProps} /&gt;
      &lt;/RainbowKitProvider&gt;
    &lt;/WagmiConfig&gt;
  );
}
</code></pre>
<p>[/code]</p>
<p>這樣在 <code>index.tsx</code> 中使用 Rainbow Kit 的 <code>ConnectButton</code> 元件就可以了。</p>
<h3 id="3-rainbow-kit-客製選項"><a class="header" href="#3-rainbow-kit-客製選項">3. Rainbow Kit 客製選項</a></h3>
<p>Rainbow Kit 也支援許多靈活的客製化，像 <a href="https://www.rainbowkit.com/docs/connect-button">ConnectButton</a> 可以指定是否要顯示 ETH 餘額、鏈的名稱、地址等等，例如以下寫法可以呈現比較簡易的錢包樣式</p>
<p>[code]
&lt;ConnectButton
chainStatus={"icon"}
accountStatus={"avatar"}
showBalance={false}
/&gt;</p>
<p>[/code]</p>
<p><img src="images/day06-img004-9f7542926d.png" alt="https://ithelp.ithome.com.tw/upload/images/20230915/20162294xCSDknAjOD.png" /></p>
<p>也可以指定不同的螢幕大小下用不同的選項</p>
<p>[code]
&lt;ConnectButton
chainStatus={{
largeScreen: "full",
smallScreen: "icon",
}}
accountStatus={{
largeScreen: "full",
smallScreen: "avatar",
}}
showBalance={false}
/&gt;</p>
<p>[/code]</p>
<p>也有自訂 theme 的選項，包含 light &amp; dark theme、主題色、border radius 等等</p>
<p>[code]
import { darkTheme } from "@rainbow-me/rainbowkit";</p>
<pre><code>// ...
&lt;RainbowKitProvider
  chains={chains}
  theme={darkTheme({
    accentColor: "#7b3fe4",
    accentColorForeground: "white",
    borderRadius: "large",
    fontStack: "system",
    overlayBlur: "small",
  })}
&gt;
</code></pre>
<p>[/code]</p>
<p><img src="images/day06-img005-87a770eb11.png" alt="https://ithelp.ithome.com.tw/upload/images/20230915/20162294FfjKIhr8DS.png" /></p>
<p>另外在按下 Connect Wallet 後的錢包列表也可以客製化，只要把預設使用 <code>getDefaultWallets</code> 拿到的 <code>connectors</code> 換成用 <code>connectorsForWallets</code> 並指定要呈現哪些 wallets 即可</p>
<p>[code]
import {
connectorsForWallets,
} from "@rainbow-me/rainbowkit";
import {
injectedWallet,
rainbowWallet,
walletConnectWallet,
trustWallet,
} from "@rainbow-me/rainbowkit/wallets";</p>
<pre><code>// ...
const projectId = "YOUR_PROJECT_ID";
const connectors = connectorsForWallets([
  {
    groupName: "Recommended",
    wallets: [
      injectedWallet({ chains }),
      rainbowWallet({ projectId, chains }),
      walletConnectWallet({ projectId, chains }),
      trustWallet({ projectId, chains }),
    ],
  },
]);
</code></pre>
<p>[/code]</p>
<p>這樣就可以呈現以下效果：</p>
<p><img src="images/day06-img006-4d5acf9516.png" alt="https://ithelp.ithome.com.tw/upload/images/20230915/20162294fvxVmkuie2.png" /></p>
<p>其中的 <code>projectId</code> 設定稍後會講到，至於 <code>injectedWallet</code> 指的是如果使用者有在瀏覽器安裝像 Metamask 的這種錢包 Extension，錢包就會對瀏覽器 inject 一個 <code>window.ethereum</code> object，因此使用 <code>injectedWallet</code> 就可以自動連上這種透過瀏覽器 Extension 安裝的錢包。Rainbow Kit 提供許多錢包選項（<a href="https://www.rainbowkit.com/docs/custom-wallet-list">官方文件</a>），有興趣的話可以任選幾個放進錢包列表中看看效果。</p>
<p>另一個 Rainbow Kit 做得很方便的點是在手機上的體驗，因為在手機上的錢包 App 跟我們瀏覽 DApp 時可能會不一樣，例如大家可能用 Chrome 或 Safari 瀏覽 DApp，但需要連接到 Metamask 的錢包 App，所以當按下 Metamask 時就會透過 Deep Link 的方式跳轉到 Metamask 中詢問是否要連接。可以用手機體驗看看 <a href="rainbowkit.com">RainbowKit 官網</a>的連接錢包功能（前提是要先安裝 Metamask App，讀者可以把電腦上的 Metamask 註記詞匯入到 Metamask 手機 app 上，這樣就能讓兩邊的錢包地址一致）。</p>
<p><img src="images/day06-img007-cadd030187.png" alt="https://ithelp.ithome.com.tw/upload/images/20230915/20162294YfQ5I9bLjB.png" /></p>
<h3 id="4-wallet-connect-協議"><a class="header" href="#4-wallet-connect-協議">4. Wallet Connect 協議</a></h3>
<p>在預設的錢包列表中有個選項是 Wallet Connect，點擊後會看到一個 QR Code，這個是方便使用者在不同裝置上使用錢包跟 DApp 的協議，例如蠻多人常用手機錢包來連接電腦上開的 DApp。有安裝 Metamask App 的話可以透過右上角的掃瞄功能來掃這個 QR Code，就會跳出連接錢包的選項。</p>
<p><img src="images/day06-img008-f588440e4d.jpg" alt="https://ithelp.ithome.com.tw/upload/images/20230915/20162294S5d2OVWju6.jpg" /></p>
<p>這樣後續只要 DApp 發出任何交易簽名的請求，錢包 App 就會跳出來讓使用者確認，並處理確認或拒絕相對應的行為，這個在一般錢包 App 中已經算是標配的功能。Wallet Connect 也有提供對應的 SDK 讓 DApp 方便整合這個功能（<a href="https://github.com/walletconnect/walletconnect-monorepo">Github 連結</a>），一樣是有考慮到 Desktop 跟 Mobile 裝置上的不同。預設的樣式長得像這樣，也算是蠻常在其他 DApp 連接錢包時看到的畫面</p>
<p><img src="images/day06-img009-dbfed3489e.png" alt="https://ithelp.ithome.com.tw/upload/images/20230915/20162294aW98drq9ZJ.png" /></p>
<p>不過目前 DApp 如果要支援 Wallet Connect （目前最新版是 v2），就要先到 <a href="https://cloud.walletconnect.com">Wallet Connect Cloud</a> 註冊一個自己的 DApp 才能正常使用。照著指示註冊後建立一個新的 Project，就會在裡面看到你的 Project ID，這個 ID 就是前面 <code>projectId</code> 所需要的值了。</p>
<p><img src="images/day06-img010-4ab8fe0195.png" alt="https://ithelp.ithome.com.tw/upload/images/20230915/20162294MhHbzy8He0.png" /></p>
<h3 id="5-rainbow-kit--wallet-connect"><a class="header" href="#5-rainbow-kit--wallet-connect">5. Rainbow Kit + Wallet Connect</a></h3>
<p>有了 Rainbow Kit 以及 Wallet Connect，就可以把前一天的 DApp 改寫成使用 Rainbow Kit 的方式，這樣像連接錢包、顯示餘額、顯示及切換鏈等等功能就都不用自己做了，因為 <code>ConnectButton</code> 已經內建這些功能，只需要留下顯示 UNI Token Balance 的部分即可。以下是 <code>profile.tsx</code> 改寫後的內容（為求簡短只留 return 的部分）</p>
<p>[code]
return (
&lt;div
style={{
display: "flex",
flexDirection: "column",
alignItems: "center",
}}
&gt;
<ConnectButton />
{uniBalance &amp;&amp; (
&lt;&gt;
<div>UNI Balance: {uniBalance}</div>
&lt;button onClick={() =&gt; sendUniTx()}&gt;Send UNI</button>
{isLoading &amp;&amp; <div>Check Your Wallet...</div>}
{isSuccess &amp;&amp; <div>Transaction Hash: {txData?.hash}</div>}
&lt;/&gt;
)}
</div>
);</p>
<p>[/code]</p>
<p>以及在 <code>_app.tsx</code> 呼叫 <code>configureChains</code> 時多給他 <code>sepolia</code> 這條鏈</p>
<p>[code]
const { chains, publicClient, webSocketPublicClient } = configureChains(
[
mainnet,
sepolia,
polygon,
optimism,
arbitrum,
base,
zora,
...(process.env.NEXT_PUBLIC_ENABLE_TESTNETS === "true" ? [goerli] : []),
],
[
alchemyProvider({ apiKey: process.env.NEXT_PUBLIC_ALCHEMY_KEY! }),
publicProvider(),
]
);</p>
<p>[/code]</p>
<p>這樣就可以用 Metamask App 搭配 Wallet Connect 來連接這個 DApp 了。首先把 Metamask App 中的鏈切換成 Sepolia（一樣要開啟 Show test networks 的選項）</p>
<p><img src="images/day06-img011-97b75dd303.png" alt="https://ithelp.ithome.com.tw/upload/images/20230915/20162294itn43TVJ3r.png" /></p>
<p>再到 <code>[localhost:3000/profile](http://localhost:3000/profile)</code> 頁面按下 Connect Wallet，用跟前面一樣的步驟讓 Metamask 透過 Wallet Connect 連上，就可以看到 UNI Token Balance 了</p>
<p><img src="images/day06-img012-cabcd960aa.png" alt="https://ithelp.ithome.com.tw/upload/images/20230915/20162294lCupSS9R0v.png" /></p>
<p>再按下 Send UNI 後，Metamask App 裡就會跳出交易的請求，按下確認就能成功送出交易了！</p>
<p><img src="images/day06-img013-744feb1824.png" alt="https://ithelp.ithome.com.tw/upload/images/20230915/20162294dbmbU5GnZQ.png" /></p>
<h3 id="6-小結"><a class="header" href="#6-小結">6. 小結</a></h3>
<p>今天我們使用 Rainbow Kit 來方便的實現連接錢包的功能，也了解 Wallet Connect 的運作方式並實際把前一天實作的 DApp 用 Rainbow Kit 改寫，支援多個錢包以及 Wallet Connect 協議，並在最後成功送出了交易，完整的程式碼在<a href="https://github.com/a00012025/ironman-2023-web3-fullstack/tree/main/frontend/day6">這裡</a>。明天會開始實作一個 DApp 常見的功能，它跟前後端都會有關係，也就是「錢包登入」。敬請期待！</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="day05-day-5-web3-與前端-幫-dapp-加功能.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="day07-day-7-web3-與前端-實作錢包登入-part-1.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="day05-day-5-web3-與前端-幫-dapp-加功能.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="day07-day-7-web3-與前端-實作錢包登入-part-1.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>
